import{r,j as e,a as b,M as g,C as j,c as v,R as N}from"../chunks/ModelStatus.Cu0Do625.js";function w({messages:c,onSendMessage:d,isLoading:a,disabled:o}){const[n,x]=r.useState(""),u=r.useRef(null),p=r.useRef(null);r.useEffect(()=>{m()},[c]);const m=()=>{u.current?.scrollIntoView({behavior:"smooth"})},h=s=>{s.preventDefault(),n.trim()&&!a&&!o&&(d(n.trim()),x(""))},f=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),h(s))},y=["What's the best deal on this page?","Are there any free shipping codes?","Which coupon saves me the most?","Tell me about this product"];return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"flex-1 overflow-auto p-4",children:c.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-400 mb-4",children:e.jsx("svg",{className:"w-12 h-12 mx-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"AI Shopping Assistant"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"Ask me about products, deals, or shopping advice!"}),e.jsx("div",{className:"space-y-2",children:y.map((s,t)=>e.jsx("button",{onClick:()=>!o&&d(s),className:`block w-full text-left px-4 py-2 text-sm 
                           bg-gray-100 hover:bg-gray-200 rounded-lg 
                           transition-colors`,disabled:o,children:s},t))})]}):e.jsxs("div",{className:"space-y-4",children:[c.map(s=>e.jsx("div",{className:b("flex",s.role==="user"?"justify-end":"justify-start"),children:e.jsxs("div",{className:b("chat-bubble",s.role==="user"?"chat-bubble-user":"chat-bubble-assistant"),children:[s.content,s.citations&&s.citations.length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-200",children:[e.jsx("p",{className:"text-xs font-medium mb-1",children:"Sources:"}),s.citations.map((t,l)=>e.jsxs("div",{className:"text-xs text-gray-600",children:["[",t.type,"] ",t.text]},l))]})]})},s.id)),a&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"chat-bubble chat-bubble-assistant",children:e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})}),e.jsx("div",{ref:u})]})}),e.jsx("form",{onSubmit:h,className:"border-t p-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("textarea",{ref:p,value:n,onChange:s=>x(s.target.value),onKeyDown:f,placeholder:o?"AI model loading...":"Ask about deals, products, or shopping...",disabled:o||a,rows:1,className:`flex-1 px-3 py-2 border border-gray-300 rounded-lg 
                     focus:outline-none focus:ring-2 focus:ring-primary-500 
                     focus:border-transparent resize-none disabled:bg-gray-100
                     disabled:text-gray-500`}),e.jsx("button",{type:"submit",disabled:o||a||!n.trim(),className:"btn-primary px-4 py-2",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]})})]})}function S(){const[c,d]=r.useState("coupons"),[a,o]=r.useState(null),[n,x]=r.useState([]),[u,p]=r.useState(!1);r.useEffect(()=>(window.addEventListener("message",m),()=>window.removeEventListener("message",m)),[n]);const m=t=>{if(t.source===window.parent)switch(t.data.type){case"PAGE_DATA":o(t.data.payload);break;case"MODEL_STATUS":a&&o({...a,modelStatus:t.data.payload.status});break;case"COUPON_APPLIED":t.data.payload.success?s("Coupon applied successfully!","success"):s(`Failed: ${t.data.payload.error}`,"error");break;case"CHAT_RESPONSE":if(t.data.payload.success){const l={id:Date.now().toString(),role:"assistant",content:t.data.payload.data.response,timestamp:Date.now()};x(i=>[...i,l])}p(!1);break}},h=t=>{window.parent.postMessage({type:"APPLY_COUPON",payload:{code:t}},"*")},f=t=>{const l={id:Date.now().toString(),role:"user",content:t,timestamp:Date.now()};x(i=>[...i,l]),p(!0),window.parent.postMessage({type:"SEND_CHAT",payload:{messages:[...n,l]}},"*")},y=()=>{window.parent.postMessage({type:"CLOSE_SIDEBAR"},"*")},s=(t,l)=>{const i=document.createElement("div");i.className=`fixed top-4 right-4 px-4 py-2 rounded-lg text-white ${l==="success"?"bg-green-500":"bg-red-500"} animate-fade-in`,i.textContent=t,document.body.appendChild(i),setTimeout(()=>{i.remove()},3e3)};return e.jsxs("div",{className:"h-screen flex flex-col bg-white",children:[e.jsxs("header",{className:"bg-primary-600 text-white px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-lg font-semibold",children:"SimplyCodes Assistant"}),e.jsx(g,{status:a?.modelStatus||"loading",light:!0})]}),e.jsx("button",{onClick:y,className:"p-1 hover:bg-primary-700 rounded transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex border-b",children:[e.jsxs("button",{className:`flex-1 px-4 py-3 text-sm font-medium transition-colors ${c==="coupons"?"text-primary-600 border-b-2 border-primary-600":"text-gray-600 hover:text-gray-900"}`,onClick:()=>d("coupons"),children:["Coupons (",a?.coupons.length||0,")"]}),e.jsx("button",{className:`flex-1 px-4 py-3 text-sm font-medium transition-colors ${c==="chat"?"text-primary-600 border-b-2 border-primary-600":"text-gray-600 hover:text-gray-900"}`,onClick:()=>d("chat"),children:"AI Assistant"})]}),e.jsx("main",{className:"flex-1 overflow-hidden",children:c==="coupons"?e.jsxs("div",{className:"h-full flex flex-col",children:[a?.cartTotal&&e.jsx("div",{className:"px-4 py-3 bg-gray-50 border-b",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Cart Total:"}),e.jsxs("span",{className:"font-semibold",children:["$",a.cartTotal.toFixed(2)]})]})}),e.jsx("div",{className:"flex-1 overflow-auto",children:a?.coupons.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"No coupons available for this site"}):e.jsx(j,{coupons:a?.coupons||[],onApply:h})})]}):e.jsx(w,{messages:n,onSendMessage:f,isLoading:u,disabled:a?.modelStatus!=="ready"})}),e.jsx("footer",{className:"px-4 py-2 bg-gray-50 border-t text-xs text-gray-500 text-center",children:"Privacy-first AI â€¢ All processing happens locally"})]})}v.createRoot(document.getElementById("root")).render(e.jsx(N.StrictMode,{children:e.jsx(S,{})}));
